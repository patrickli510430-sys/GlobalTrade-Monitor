<!-- 
  ========================================
  Project: GlobalTrade Monitor
  File:    settings.html
  Author:  [Wenxuan Li/Patrickli]
  Date:    2025-12-18
  Description: 
      Core dashboard template utilizing HTMX for 
      real-time updates and Alpine.js for interactions.
  ========================================
-->

<div class="grid grid-cols-12 gap-8 animate-[fadeIn_0.5s_ease-out]" x-data="{ showDetailModal: false }">
    
    <!-- 1. æ€»èµ„äº§å¡ç‰‡ -->
    <div class="col-span-12 lg:col-span-6 glass-card rounded-[2rem] p-10 relative overflow-hidden group bg-white/80">
         
         <div class="flex justify-between items-start mb-6">
            <div class="text-slate-400 font-bold text-xs uppercase tracking-[0.15em]">{{ t.portfolio_value }}</div>
            
            <!-- ðŸŸ£ å³ä¸Šè§’å¯è§†åŒ–æŒ‰é’® (å®Œå–„ç‰ˆ) -->
            <button @click="showDetailModal = true; setTimeout(() => initDetailCharts(), 100)" 
                    class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-200 hover:scale-110 hover:shadow-indigo-400 transition-all duration-300 z-20 cursor-pointer group-btn">
                <i class="fa-solid fa-chart-simple text-xl group-hover:scale-110 transition-transform"></i>
            </button>
         </div>
         
         <div class="flex items-baseline gap-2 mb-4">
             <span class="text-2xl font-bold text-slate-400">Â¥</span>
             <span class="text-6xl font-black text-slate-900 tracking-tighter">
                 {{ "{:,.0f}".format(total_value) }}
             </span>
         </div>
         
         <div class="flex items-center gap-2 text-emerald-500 font-bold text-sm bg-emerald-50 w-fit px-3 py-1 rounded-full italic border border-emerald-100">
             <i class="fa-solid fa-arrow-trend-up"></i> {{ t.analysis_ready }}
         </div>

         <!-- è£…é¥°èƒŒæ™¯ -->
         <div class="absolute -right-10 -bottom-10 opacity-5 group-hover:opacity-10 transition-opacity pointer-events-none">
             <i class="fa-solid fa-sack-dollar text-9xl"></i>
         </div>
    </div>

    <!-- 2. æ±‡çŽ‡ Widget (ä¿æŒä¸å˜ï¼Œä½†ä½¿ç”¨ t.live_rates) -->
    <div class="col-span-12 lg:col-span-6 glass-card rounded-[2rem] p-10 bg-white/80 flex flex-col relative overflow-hidden"
         x-data="{ activeCurr: 'USD', rates: { {% for c,r in rates.items() %}'{{c}}':{{r}},{% endfor %} } }">
         <div class="flex justify-between items-start mb-8 z-10 relative">
            <div class="text-slate-400 font-bold text-xs uppercase tracking-[0.15em]">{{ t.live_rates }}</div>
            <div class="flex gap-2">
                <template x-for="curr in ['USD', 'EUR', 'JPY', 'GBP']">
                    <button @click="activeCurr = curr" class="px-3 py-1 rounded-lg text-[10px] font-black transition-all" :class="activeCurr === curr ? 'bg-slate-900 text-white shadow-lg' : 'bg-slate-100 text-slate-400 hover:bg-slate-200'">
                        <span x-text="curr"></span>
                    </button>
                </template>
            </div>
         </div>
         <div class="mt-auto z-10 relative">
             <div class="flex items-end gap-3 mb-2">
                 <span class="text-6xl font-black text-slate-900 tracking-tighter" x-text="rates[activeCurr]"></span>
                 <span class="text-xl font-bold text-slate-400 mb-2">CNY</span>
             </div>
         </div>
         <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
    </div>

    <!-- ðŸŸ¢ æ¨¡æ€æ¡† (è¯¦ç»†åˆ†æž) -->
    <div x-show="showDetailModal" style="display: none;" 
         class="fixed inset-0 z-[100] flex items-center justify-center p-4">
        
        <!-- èƒŒæ™¯é®ç½© -->
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-md" @click="showDetailModal = false"></div>
        
        <!-- æ¨¡æ€æ¡†å†…å®¹ -->
        <div class="relative bg-white w-full max-w-5xl rounded-[3rem] shadow-2xl p-10 animate-[zoomIn_0.3s_ease-out] overflow-hidden">
            
            <!-- æ ‡é¢˜æ  -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Deep Dive</div>
                    <h2 class="text-3xl font-black text-slate-900 tracking-tight">{{ t.modal_title }}</h2>
                </div>
                <button @click="showDetailModal = false" class="p-3 bg-slate-100 rounded-2xl hover:bg-slate-200 transition-colors">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>

            <!-- å›¾è¡¨åŒºåŸŸ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- é¥¼å›¾ï¼šå“ç±»å æ¯” -->
                <div class="md:col-span-1 bg-slate-50 rounded-[2rem] p-6">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-chart-pie text-indigo-500"></i> {{ t.modal_cat }}
                    </h4>
                    <div id="modalPieChart" class="w-full h-[250px]"></div>
                </div>

                <!-- æŠ˜çº¿å›¾ï¼šèµ„äº§è¶‹åŠ¿ -->
                <div class="md:col-span-2 bg-slate-50 rounded-[2rem] p-6">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-arrow-trend-up text-emerald-500"></i> {{ t.modal_trend }} (CNY)
                    </h4>
                    <div id="modalLineChart" class="w-full h-[250px]"></div>
                </div>
            </div>
            
            <!-- åº•éƒ¨æ•°æ®æ  -->
            <div class="mt-8 flex gap-4">
                <div class="flex-1 bg-indigo-600 text-white p-6 rounded-[2rem] flex justify-between items-center shadow-xl shadow-indigo-200">
                    <div>
                        <div class="text-[10px] font-black uppercase opacity-60">Total Asset</div>
                        <div class="text-3xl font-black">Â¥ {{ "{:,.0f}".format(total_value) }}</div>
                    </div>
                    <i class="fa-solid fa-wallet text-3xl opacity-50"></i>
                </div>
                <div class="flex-1 bg-white border border-slate-200 text-slate-900 p-6 rounded-[2rem] flex justify-between items-center">
                    <div>
                        <div class="text-[10px] font-black uppercase text-slate-400">Total Items</div>
                        <div class="text-3xl font-black">1,248</div>
                    </div>
                    <i class="fa-solid fa-boxes-stacked text-3xl text-slate-200"></i>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // åœ¨æ¨¡æ€æ¡†æ‰“å¼€æ—¶åˆå§‹åŒ–å›¾è¡¨
    function initDetailCharts() {
        // 1. é¥¼å›¾
        var pieDom = document.getElementById('modalPieChart');
        if (echarts.getInstanceByDom(pieDom)) { echarts.getInstanceByDom(pieDom).dispose(); }
        var pieChart = echarts.init(pieDom);
        pieChart.setOption({
            color: ['#6366f1', '#a855f7', '#ec4899', '#f97316'],
            tooltip: { trigger: 'item' },
            series: [{
                type: 'pie', radius: ['40%', '70%'], 
                itemStyle: { borderRadius: 10, borderColor: '#f8fafc', borderWidth: 2 },
                label: { show: false },
                data: [
                    { value: 1048, name: '{{ t.modal_elec }}' },
                    { value: 735, name: '{{ t.modal_fashion }}' },
                    { value: 580, name: '{{ t.modal_home }}' },
                    { value: 484, name: '{{ t.modal_beauty }}' }
                ]
            }]
        });

        // 2. è¶‹åŠ¿å›¾
        var lineDom = document.getElementById('modalLineChart');
        if (echarts.getInstanceByDom(lineDom)) { echarts.getInstanceByDom(lineDom).dispose(); }
        var lineChart = echarts.init(lineDom);
        lineChart.setOption({
            grid: { top: 10, right: 10, bottom: 20, left: 40 },
            tooltip: { trigger: 'axis' },
            xAxis: { type: 'category', data: ['W1', 'W2', 'W3', 'W4'], axisLine: { show: false } },
            yAxis: { type: 'value', splitLine: { lineStyle: { type: 'dashed' } } },
            series: [{
                data: [{{ total_value * 0.9 }}, {{ total_value * 0.95 }}, {{ total_value * 0.92 }}, {{ total_value }}],
                type: 'line', smooth: true, 
                lineStyle: { color: '#10b981', width: 4 },
                areaStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{offset: 0, color: '#10b98166'}, {offset: 1, color: '#10b98100'}]) }
            }]
        });
        
        // Resize
        window.addEventListener('resize', () => { pieChart.resize(); lineChart.resize(); });
    }
</script>